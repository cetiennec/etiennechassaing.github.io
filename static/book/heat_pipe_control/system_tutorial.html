
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Heated Pipe System with Heat Losses &#8212; My Projects</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'heat_pipe_control/system_tutorial';</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@1.0.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Precision-landing of a Parrot drone" href="../drone_delayed_control/case_study.html" />
    <link rel="prev" title="Project tutorials" href="../index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">My Projects</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Project tutorials
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Heated Pipe System with Heat Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drone_delayed_control/case_study.html">Precision-landing of a Parrot drone</a></li>





</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/heat_pipe_control/system_tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/heat_pipe_control/system_tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Heated Pipe System with Heat Losses</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-description">1. System Description</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-findings-why-is-it-tricky">First findings, why is it tricky?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-model">Naive model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-modeling">2. System Modeling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#physical-model-equations">Physical model equations:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-simulation">System Simulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control">3. Control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-objectives">Control Objectives</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traditionnal-siso-control-technique-with-tinkering">1) Traditionnal SISO control technique, with tinkering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-control-via-mpc-simo-control-fashion">2) Optimal control via MPC, SIMO control fashion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reinforcement-learning">3) Reinforcement Learning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-and-conclusion">Comparison and conclusion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performances-constant-setpoint-tracking">Performances : Constant setpoint tracking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performances-ramp-setpoint-tracking">Performances : Ramp setpoint tracking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security">Security</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complexity-flexibility-and-running-frequency">Complexity, Flexibility and running frequency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">Appendix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-details-impact-of-coefficients">Simulation details : Impact of coefficients:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mpc-details-model-accuracy">MPC details : Model accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-on-code-and-llm-usage">Note on code and LLM usage:</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="heated-pipe-system-with-heat-losses">
<h1>Heated Pipe System with Heat Losses<a class="headerlink" href="#heated-pipe-system-with-heat-losses" title="Link to this heading">#</a></h1>
<p>This tutorial demonstrates the approach to regulating the outlet temperature of a 450-meter heat pipe near its boiling point, emphasizing the solution methodology over equation details</p>
<hr class="docutils" />
<section id="system-description">
<h2>1. System Description<a class="headerlink" href="#system-description" title="Link to this heading">#</a></h2>
<p>The system consists of a 450 mm circular pipe through which water flows continuously. A heater is connected at the entrance (<span class="math notranslate nohighlight">\(x = 0\)</span>)
of the pipe, providing a constant power input <span class="math notranslate nohighlight">\(P\)</span> to the water. The water flows with constant velocity <span class="math notranslate nohighlight">\(u\)</span>, losing heat
to the environment due to convection. At the outlet, the water returns to the heater, creating a closed loop.</p>
<p><img alt="heat loop" src="../_images/simple_diagram.png" /></p>
<p>The goal is to perform a bacteria decontamination of the loop, requiring a temperature of at least 85°C through the loop
with a 2°C/min ascent and without creating steam in the pipe.</p>
<p><em><strong>How to ensure <span class="math notranslate nohighlight">\(T_{outlet}\)</span>&gt;85°C and <span class="math notranslate nohighlight">\(T_{inlet}\)</span>&lt;95°C ? Can we control the heating speed precisely to 2°C/min?</strong></em></p>
<section id="first-findings-why-is-it-tricky">
<h3>First findings, why is it tricky?<a class="headerlink" href="#first-findings-why-is-it-tricky" title="Link to this heading">#</a></h3>
<p>Following plot shows what happens when the system is heated at a constant 30kW power which is barely the maximum power :</p>
<p><img alt="heat loop" src="../_images/initial_problem.png" /></p>
<p>From this we observe :</p>
<ul class="simple">
<li><p>Stair-like behavior due to the recirculation of water</p></li>
<li><p>An inlet temperature that can go close to 100°C despite an outlet temperature that is barely above 85°C</p></li>
<li><p>A significant delay (~12 min)</p></li>
<li><p>A coupling and an intrication between inlet and outlet temperature</p></li>
<li><p>A single test is about 3 hours to consider rising time</p></li>
<li><p><strong>Perfomances</strong> are defined on outlet temperature</p></li>
<li><p><strong>Security</strong> is defined on inlet temperature</p></li>
</ul>
<p><strong>How to model and simulate these stairs and avoid testing on the real system?</strong></p>
</section>
<section id="naive-model">
<h3>Naive model<a class="headerlink" href="#naive-model" title="Link to this heading">#</a></h3>
<p>The following simulation divides the pipe into small segments to model heat transfer step by step. At each time step, every segment’s
temperature is updated based on its neighbors and the environment (using a heat loss coefficient), while the temperature at the pipe’s end is “pushed forward”
to the start—like a wave of heat moving through. The heater at one end injects warmth, and the animation reveals how heat spreads,
stabilizes, and flows through the system.</p>
<p><img alt="heat loop" src="../_images/pipe_simulation.gif" /></p>
<p>This gives a first approximation and intuition on the system to explain the stairs, how the heat is exchanged and the impact of losses on the heating curve.</p>
<p>Detailed plots in Appendix show the impact of heat loss coefficient and external temperature on the curves.</p>
</section>
</section>
<section id="system-modeling">
<h2>2. System Modeling<a class="headerlink" href="#system-modeling" title="Link to this heading">#</a></h2>
<section id="physical-model-equations">
<h3>Physical model equations:<a class="headerlink" href="#physical-model-equations" title="Link to this heading">#</a></h3>
<p>The system schematic is shown below:</p>
<p><img alt="heat loop" src="../_images/heat_loop.png" /></p>
<p>The evolution of the temperature in the pipe is governed by the following partial differential equation (PDE) obtained by
writing the energy balance equation of a pipe infinitesimal segment:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial T}{\partial t} + u \frac{\partial T}{\partial x} = -\frac{h P_{\text{pipe}}}{\rho S c_p} \left[ T(x, t) - T_{\text{ext}} \right]
\]</div>
<p>All notations are detailed in Appendix.</p>
<p>To include the heater power in the equations, we can write the energy balance of the heater using
<span class="math notranslate nohighlight">\( \Theta_{\text{inlet}}(t) = T_{\text{inlet}} - T_{\text{ext}} \)</span> and <span class="math notranslate nohighlight">\(\Theta_{\text{outlet}}(t) = T_{\text{outlet}} - T_{\text{ext}}\)</span>.
This allows to write the following Delayed Equations in which <span class="math notranslate nohighlight">\(\tau\)</span> is the time of travel, <span class="math notranslate nohighlight">\(P\)</span> the power of the heater, and <span class="math notranslate nohighlight">\(K&lt;1\)</span> the loss coefficient:</p>
<div class="math notranslate nohighlight">
\[
\Theta_{\text{inlet}}(t) = \frac{P}{\dot{m}c_p} + K \Theta_{\text{inlet}}(t - \tau),
\Theta_{\text{outlet}}(t) = K \left( \frac{P}{\dot{m} c_p} +  \Theta_{\text{outlet}}(t - \tau) \right).
\]</div>
<p>These equations are teaching us that:</p>
<ul class="simple">
<li><p>A pipe segment always sees the water from one turn past, which temperature is modulated by the losses,</p></li>
<li><p>From an energy point of view, the system adds to the loop the amount of energy contained by the water inside the heater,</p></li>
<li><p>Effect of the power is inversely scaled by the flow <span class="math notranslate nohighlight">\(\dot{m}\)</span> which directly affects system properties.</p></li>
</ul>
</section>
<section id="system-simulation">
<h3>System Simulation<a class="headerlink" href="#system-simulation" title="Link to this heading">#</a></h3>
<p>Previous equations are used with a ODE solver (via ODE integration) to simulate the system.
Following example show the step response of the system for a given power input :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from simulation_backend import *
from ipywidgets import interact, FloatSlider, fixed
interact(
    simulate_and_plot,
    P=FloatSlider(min=1, max=33, step=0.5, value=10, description=&#39;Power (kW):&#39;),
    T_ext=FloatSlider(min=0, max=40, step=0.5, value=10, description=&#39;External temperature (°C):&#39;)
);

# if sliders are not working:
simulate_and_plot(P=10)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "b4457f8fed5046e6af62ecb66963e29a"}</script><img alt="../_images/6155ab41498e047e281f756356f60c8e852e8a42d5b2b7fa7859c1d30e37fc40.png" src="../_images/6155ab41498e047e281f756356f60c8e852e8a42d5b2b7fa7859c1d30e37fc40.png" />
</div>
</div>
</section>
</section>
<section id="control">
<h2>3. Control<a class="headerlink" href="#control" title="Link to this heading">#</a></h2>
<section id="control-objectives">
<h3>Control Objectives<a class="headerlink" href="#control-objectives" title="Link to this heading">#</a></h3>
<p>Our system should respect the following requirements:</p>
<ul class="simple">
<li><p>Outlet temperature of at least 85°C while respecting a 2°C/min ascent</p></li>
<li><p>Ensure constant outlet temperature control</p></li>
<li><p>Ensure inlet temperature remains below 95°C</p></li>
<li><p>Be robust to external temperature changes</p></li>
</ul>
</section>
<section id="traditionnal-siso-control-technique-with-tinkering">
<h3>1) Traditionnal SISO control technique, with tinkering<a class="headerlink" href="#traditionnal-siso-control-technique-with-tinkering" title="Link to this heading">#</a></h3>
<p>The standard equation of the PI controller is:</p>
<div class="math notranslate nohighlight">
\[
u(t) = K_p \, e(t) + K_i \int_0^t e(\tau) \, d\tau,
\]</div>
<p>where:</p>
<ul class="simple">
<li><p>u(t) is the power of the heater,</p></li>
<li><p><span class="math notranslate nohighlight">\(K_p\)</span> is the proportional gain,</p></li>
<li><p><span class="math notranslate nohighlight">\(K_i\)</span> is the integral gain,</p></li>
<li><p>e(t) is the error between the setpoint and the outlet temperature.</p></li>
</ul>
<p>This is a Single Input - Single Output (SISO) controller
First simulation show the result with a P controller only.
It exhibits the need to continuously add energy to the system to compensate for the losses, hence a nonzero <span class="math notranslate nohighlight">\(K_i\)</span> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from PI_backend import *

# Interactive sliders for tuning Kp, Ki, and T_ext
interact(
    simulate_PI,
    Kp=FloatSlider(min=0, max=2000, step=50, value=1500, description=&quot;Kp [W/°C]&quot;),
    Ki=FloatSlider(min=0, max=0.5, step=0.025
                   , value=0.01, description=&quot;Ki [W/(°C·s)]&quot;),
    T_ext=FloatSlider(min=0, max=40, step=1, value=20, description=&quot;T_ext (°C)&quot;),
    T_set=fixed(85.0),
    save_csv = fixed(False),
    ramped = fixed(False),
    csv_filename = fixed(&quot;&quot;),
    alpha = fixed(10.0),
);

# if sliders are not working:
simulate_PI(Kp=1500,Ki=0, save_csv=False, T_ext =20)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "09300d74e82d401eb17b20e68f7cc614"}</script><img alt="../_images/c3161848aba5e16660bed5b2bd909de1c270a5272b6e61e5f6622d9899880762.png" src="../_images/c3161848aba5e16660bed5b2bd909de1c270a5272b6e61e5f6622d9899880762.png" />
</div>
</div>
<p>With correct tuning of the coefficients, we obtain the following behavior :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>simulate_PI(Kp=1300, Ki=0.08, T_ext=10, save_csv=True, ramped = False, csv_filename=&quot;results/PI_run_data.csv&quot;, T_set = 85);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saved PI simulation results to results/PI_run_data.csv
</pre></div>
</div>
<img alt="../_images/e355722b1052f7fd03e561d593cfc2fff45bbb2d35a5ed3d77e43f6d84fbc1e0.png" src="../_images/e355722b1052f7fd03e561d593cfc2fff45bbb2d35a5ed3d77e43f6d84fbc1e0.png" />
</div>
</div>
<p>This shows the ability of the PI controller to precisely track an outlet setpoint temperature.
The good performance can be explained by the linearity between power input and outlet temperature for a fixed external temperature.</p>
<p><strong>How to enforce constraint handling on such a controller?</strong></p>
<p>PI controllers have no direct way to ensure constraints, especially when the constraint is defined on another variable.
To overcome this issue, we propose a gain scheduling technique based on the inlet temperature.
To ensure security on inlet temperature, the gains <span class="math notranslate nohighlight">\(K\)</span> are modified dynamically based on <span class="math notranslate nohighlight">\(T_{\text{inlet}}\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[
K = K_{\text{initial}} \left( 1 - e^{-\alpha |T_{\text{inlet}} - T_{max}|} \right),
and ~K=0~ if ~T_{inlet}&gt;T_{max}
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(K_{\text{initial}}\)</span> is the initial  gain,</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> is a tuning parameter controlling the rate of gain reduction,</p></li>
<li><p><span class="math notranslate nohighlight">\(T_{max}=95°C\)</span> is the limit temperature</p></li>
</ul>
<p>This ensures that the system is maintaining security requirements in a soft manner, while tracking the reference of outlet temperature.
Results will be given below.</p>
</section>
<section id="optimal-control-via-mpc-simo-control-fashion">
<h3>2) Optimal control via MPC, SIMO control fashion<a class="headerlink" href="#optimal-control-via-mpc-simo-control-fashion" title="Link to this heading">#</a></h3>
<p>Since we have access to a model, we can explore optimal control via Model Predictive Control (MPC).
MPC leverages the model to find the best input to the system based on a horizon prediction (<span class="math notranslate nohighlight">\(N_p\)</span>).
Its strength is to be able to consider both states for a single input to the system.
At each timestep, MPC controller computes the best input sequence for the future, apply the first one, and repeat the process to ensure good predictions and response to uncertainties.</p>
<p><img alt="MPC" src="../_images/MPC_principle.png" /></p>
<p>[source : ETH]</p>
<p>To do so, MPC uses weights to formulate the control objective and respect constraints in the optimization process.
MPC formulation of the problem is as follows:</p>
<div class="math notranslate nohighlight">
\[
u^*(k) = \min_{u(0), \dots, u(N_p-1)}
\sum_{i=0}^{N_p-1} \left( y_i - (T_{set,i} - d_i) \right)^T Q \left( y_i - (T_{set,i} - d_i) \right) + u_i^T R u_i + \Delta u_i^T S \Delta u_i,
\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\text{subject to:}
\begin{align*}
&amp;\mathbf{x}(0) = \mathbf{x}_0\\
&amp;\mathbf{x}_{i+1} = A \mathbf{x}_i + B u_i,~y_i = C \mathbf{x}_i \quad i = 0, \dots, N_p-1, \\
&amp;0 \leq x_i=T_{inlet,i},T_{outlet,i} \leq 95, \quad i = 1, \dots, N_p, \\
&amp;0 \leq u_i=P_i \leq 33, \quad i = 0, \dots, N_p-1, \\
&amp;Q \succ 0, \, R \succ 0.
\end{align*}
\end{split}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x = (T_{inlet},T_{outlet} )\)</span> is the state</p></li>
<li><p><span class="math notranslate nohighlight">\(N_p\)</span> is the prediction horizon.</p></li>
<li><p><span class="math notranslate nohighlight">\(T_{set,i}\)</span> is the moving reference at time <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(d_i\)</span> is the moving disturbance (<span class="math notranslate nohighlight">\(T_{ext}\)</span>) at time <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(Q \succ 0\)</span> and <span class="math notranslate nohighlight">\(R \succ 0\)</span> are weighting matrices for output tracking and input usage, respectively.</p></li>
</ul>
<p><strong>Is MPC tractable on this problem?</strong> Think about the problem size …</p>
<p>This approach can be solved using Quadratic Programming (QP) formulation.
However, to employ this technique, difficulty lies in the fact that :</p>
<ol class="arabic simple">
<li><p>The model is high order, <span class="math notranslate nohighlight">\(x\)</span> is (1,30) for a  30 segment pipe discretization.</p></li>
<li><p>Horizon to control <span class="math notranslate nohighlight">\(T_{outlet}\)</span> should be 600, which implies dealing with huge matrices.</p></li>
</ol>
<p>For each :</p>
<ul class="simple">
<li><p>1: <span class="math notranslate nohighlight">\(N\)</span> is set to 20 to lighten the simulation, and could be tackled by using simplified models for <span class="math notranslate nohighlight">\(T_{inlet}\)</span> and <span class="math notranslate nohighlight">\(T_{outlet}\)</span> respectively</p></li>
<li><p>2: is tackled by setting the controller frequency to 0.1Hz, meaning one step is 10s, and setting the horizon to 70 steps, i.e. 700s</p></li>
</ul>
<p>Results are given below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from ipywidgets import interact, FloatSlider
from MPCRun import run_MPC

run_MPC(Hp=80, Q=[0.0, 1e3], R=1e-5, Rd=1.0, T_set=[92.0, 85.0], T_safety=95.0, ramped = False)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b0bb9229447a62df75933aa387a34921e9b257c91802b19e01af6a0ad6ea3a00.png" src="../_images/b0bb9229447a62df75933aa387a34921e9b257c91802b19e01af6a0ad6ea3a00.png" />
<img alt="../_images/6732b924316ffbf0fb104c5fbd29dfc80f7200f5df72e87014f326acbfb1a95f.png" src="../_images/6732b924316ffbf0fb104c5fbd29dfc80f7200f5df72e87014f326acbfb1a95f.png" />
</div>
</div>
<p>From this, we can observe a  more complex behavior than the PI controller which was bounded to its linear behavior.
However, this does not give any better performance since the PI controller was already leveraging the power limit to perform quick tracking.
Interestingly, a small non-zero steady state error remains.</p>
<p>As a strong advantage, this formulation is way more flexible and allows to control each temperature with the same controller.</p>
</section>
<section id="reinforcement-learning">
<h3>3) Reinforcement Learning<a class="headerlink" href="#reinforcement-learning" title="Link to this heading">#</a></h3>
<p>Reinforcement Learning (RL) uses a generic formulation of the control problem as an environment to which is inputted an action and which outputs an observation and a reward.
RL algorithms uses the reward to learn a policy <span class="math notranslate nohighlight">\(\pi(state)=action\)</span>. The goal of the learning process is to make this policy converging towards an optimal policy <span class="math notranslate nohighlight">\(*\pi^*\)</span> i.e. the one that maximizes the cumulative reward on an episode.</p>
<p><img alt="RL" src="../_images/Reinforcement_learning_diagram.svg" /></p>
<p>We define our environment as follows using our simulation :</p>
<p><strong>Action</strong></p>
<p>At each timestep, the agent selects a continuous action</p>
<div class="math notranslate nohighlight">
\[
a \in [0, 33] kW,
\]</div>
<p>which corresponds to the heater power in kilowatts.</p>
<p><strong>State (Observation)</strong></p>
<p>The observation provided to the agent is a vector of five components:</p>
<div class="math notranslate nohighlight">
\[
obs = \big(T_{\text{inlet}},\; T_{\text{outlet}},\; T_{\text{sp}},\; T_{\text{sp}} - T_{\text{outlet}},\; T_{\text{safety}} - T_{\text{inlet}}\big),
\]</div>
<p><strong>Note 1</strong> : these are a bit redundant and are used for simulation simplicity, for a more general case, <span class="math notranslate nohighlight">\(T_{ext}\)</span> should also be included to allow the agent to react to fast temperature changes from the environment.</p>
<p><strong>Note 2</strong> : For control, relative observation allows to make the developed policy independant of the setpoint value.</p>
<p><strong>Reward</strong></p>
<p>The reward balances setpoint tracking, smooth control, energy usage, and safety:</p>
<div class="math notranslate nohighlight">
\[
r = -\lvert T_{\text{sp}} - T_{\text{out}} \rvert
    - \lambda_{\Delta P}\,|P - P_{\text{prev}}|
    + \lambda_P P
    + r_{\text{safety}}.
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(-\lvert T_{\text{sp}} - T_{\text{out}} \rvert\)</span>: directly penalizes deviation from the outlet setpoint,</p></li>
<li><p><span class="math notranslate nohighlight">\(-\lambda_{\Delta P}\,|P - P_{\text{prev}}|\)</span>: penalizes fast changes in heater power and incentive constant power,</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda_P P\)</span>: small incentive for using heater power, this helps to explore despite large delay,</p></li>
<li><p><span class="math notranslate nohighlight">\(r_{\text{safety}} = -10\)</span> if <span class="math notranslate nohighlight">\(T_1 &gt; T_{\text{safety}}\)</span>, otherwise <span class="math notranslate nohighlight">\(0\)</span>.</p></li>
</ul>
<p><strong>Algorithm</strong></p>
<p>Soft Actor-Critic <a class="reference external" href="https://stable-baselines3.readthedocs.io/en/master/modules/sac.html">SAC</a> is chosen for its good versatility and performances.</p>
<p><strong>Results</strong></p>
<p>To prevent noisy outputs from the RL controller, actions are filteredd with an average filter (<span class="math notranslate nohighlight">\(\alpha=0.2\)</span>) giving :</p>
<p><img alt="filtRL" src="../_images/filtered_RL_results.png" /></p>
<p>This problem could also be solved by discretizing the output of the RL controller, allowing for 0.5 kW steps only (for example).
Despite filtering, RL controller fails tracking precisely the target temperature with precision.</p>
</section>
</section>
<section id="comparison-and-conclusion">
<h2>Comparison and conclusion<a class="headerlink" href="#comparison-and-conclusion" title="Link to this heading">#</a></h2>
<p>We compare and discuss the 3 methods based on:</p>
<ul class="simple">
<li><p>Their performances on setpoint tracking</p></li>
<li><p>The compliance with the security criterion on inlet temperature</p></li>
<li><p>Their complexity of validation and integration</p></li>
</ul>
<section id="performances-constant-setpoint-tracking">
<h3>Performances : Constant setpoint tracking<a class="headerlink" href="#performances-constant-setpoint-tracking" title="Link to this heading">#</a></h3>
<p>On the task of tracking a constant outlet temperature, all the controllers achieve similar performances. This is due to :</p>
<ul class="simple">
<li><p>The saturation of the input between 0 and 25 min approximately</p></li>
<li><p>The fact that the system is mainly linear, meaning that an optimal linear controller exists</p></li>
</ul>
<p>Comparison of the 3 approaches is presented below. The PI controller is the most precise one, RL controller fails maintaining a constant temperature and MPC suffers from a small steady-state error of 0.4°C.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from compare_everything import plot_comparison_step

plot_comparison_step()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d314541c19048615cef98aeec7f11d4d3382de9548adba29d077db74f21e0a11.png" src="../_images/d314541c19048615cef98aeec7f11d4d3382de9548adba29d077db74f21e0a11.png" />
</div>
</div>
</section>
<section id="performances-ramp-setpoint-tracking">
<h3>Performances : Ramp setpoint tracking<a class="headerlink" href="#performances-ramp-setpoint-tracking" title="Link to this heading">#</a></h3>
<p>To discriminate their capabilities, we can compare them on the tracking of a ramped temperature of 2°/min with a saturation at 85°C.</p>
<p>The PI controller can be fine-tuned to track the reference:</p>
<p><strong>Warning, this example is a bit tricky because the PI controller has no information about the delay, the fact it is able to track it accordingly is due to a specific tuning, to use a PI controller properly on this system, a delay compensator should be integrated</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>simulate_PI(Kp=1300, Ki=0.15, T_ext=10, save_csv=True, ramped = True, csv_filename=&quot;results/ramp_PI_run_data.csv&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saved PI simulation results to results/ramp_PI_run_data.csv
</pre></div>
</div>
<img alt="../_images/062af88d1f1df4d5a732e678994e673ffb62c62420d13429b6d016a116a58a7b.png" src="../_images/062af88d1f1df4d5a732e678994e673ffb62c62420d13429b6d016a116a58a7b.png" />
</div>
</div>
<p>This shows that, with correct tuning, we can obtain a 2°C rate, but technically the temperature is not following the setpoint, meaning that this is more of a lucky behavior due to controller tuning.</p>
<p>MPC and RL are run on the ramp reference with same tuning as before.
For the MPC controller :</p>
<p><img alt="MPC_results_ramp" src="../_images/ramp_MPC_results.png" /></p>
<p>And for the RL controller, we obtain :</p>
<p><img alt="ramp_RL_results" src="../_images/ramp_RL_results.png" /></p>
<p>Comparison is given below :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from compare_everything import plot_comparison_ramp

plot_comparison_ramp()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/59ddf57fd3e5dafbc0bdefd10a3daf307e275b16385e443623aa85158d3b4169.png" src="../_images/59ddf57fd3e5dafbc0bdefd10a3daf307e275b16385e443623aa85158d3b4169.png" />
</div>
</div>
<p>The MPC controller can track the reference without fine-tuning, as it can predict to use a given input for its future output.
RL has not been trained on the ramp following and exhibits its limitation on out-of-distribution example, meaning the training was not good enough for the controller to generalize.
PI controller creates a roughly 2°C/min ramp due to a good tuning but is unable to make the outlet temperature converge to the setpoint during ramp time.</p>
</section>
<section id="security">
<h3>Security<a class="headerlink" href="#security" title="Link to this heading">#</a></h3>
<p>The system we studied has some inherent risks which can disturb the controllers, among which :</p>
<ol class="arabic simple">
<li><p>Control instability</p></li>
<li><p>Boiling water or steam at pipe inlet</p></li>
<li><p>Rapid change in external temperature</p></li>
<li><p>Sensor failure</p></li>
</ol>
<p><strong>Stability</strong></p>
<p>The slow dynamics of the system makes it inherently stable.
However, trying to heat quicker implies using high gains which could result in instability, for the PI controller this is handled by checking the closed loop stability via Nyquist criterion (See <a class="reference external" href="https://en.wikipedia.org/wiki/Nyquist_stability_criterion">here</a>) using Bode diagram of the PI controller:</p>
<p><img alt="Bode" src="../_images/Bode_PI.png" /></p>
<p>Similar reasoning can be performed on the MPC controller using assumptions on cost to conclude on a Lyapunov stability.</p>
<p>RL controller is harder to validate for stability, only multiple simulation on the learned controller can allow to evaluate its stability. On smaller observation space, the policy function could be studied in a bounded space to conclude on system stability using closed loop arguments.</p>
<p><strong>Boiling water</strong></p>
<p>The risk of having boiling water or steam in the system is the most dangerous risk of the system which could damage the pipes, or harm an operator.
To mitigate the risk</p>
<ul class="simple">
<li><p>Gain scheduling based on inlet temperature can be used on PI controllers, the lower <span class="math notranslate nohighlight">\(\alpha\)</span> is, the stronger the security is:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>from PI_backend import *

# Interactive sliders for tuning Kp, Ki, and T_ext
interact(
    simulate_PI,
    Kp=fixed(1300.0),
    Ki=fixed(0.08),
    T_ext=FloatSlider(min=0, max=40, step=1, value=20, description=&quot;T_ext (°C)&quot;),
    T_set=FloatSlider(min=0, max=95, step=1, value=92, description=&quot;T_set (°C)&quot;),
    save_csv = fixed(False),
    ramped = fixed(False),
    csv_filename = fixed(&quot;&quot;),
    alpha=FloatSlider(min=0.1, max=10, step=0.5, value=8, description=&quot;alpha&quot;),
);

#if sliders are not working :
simulate_PI(Kp=1300, Ki=0.08, save_csv=False, T_ext=20, alpha=5, T_set=95)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "71fcf2a4838441fa81fcd883a82a1ab1"}</script><img alt="../_images/e59dbc3fa55ea8278c0f76c9d6f3507602e53d49af0c7ba1aeaeb21d55bf39d8.png" src="../_images/e59dbc3fa55ea8278c0f76c9d6f3507602e53d49af0c7ba1aeaeb21d55bf39d8.png" />
</div>
</div>
<ul class="simple">
<li><p>MPC controller is inherently respecting constraints, if the optimization process is correctly set up. Meaning it would get as close as possible to unfeasible points.</p></li>
</ul>
<ul class="simple">
<li><p>RL controller has a dedicated reward to avoid high temperatures but needs to be carefully checked in simulation. Current controller is respecting contraints but fails converging to a different setpoint, meaning the learning process did not generalize properly:</p></li>
</ul>
<p><img alt="security_RL_results" src="../_images/security_RL_result.png" /></p>
<p>Technically, the difference between inlet and outlet temperatures converges to a fixed value.
Thus, no problem should occur if the outlet setpoint is chosen below a certain max value.
However, regardless of the chosen method a security mechanism has to be implemented to stop heating if temperature goes above a certain value.
This can be made via continuous decreasing (equivalent to scheduling) or discrete turn-off.</p>
<p><strong>Rapid changes in external temperature</strong></p>
<p>Rapid changes of the external temperature could threaten controllers ability to steer the temperatures to their setpoints.
The effect of <span class="math notranslate nohighlight">\(T_{ext}\)</span> and the robustness of the current controllers can be assessed in simulation on specific use-cases. This has been done using sine wave of +/- 5°C on <span class="math notranslate nohighlight">\(T_{ext}\)</span> with a period of half an hour on the PI controller + gain scheduler. This showed the controller ability to respect the security constraints, while sometimes taking a bit of time to overcome the disturbance.</p>
<p>For a proper validation :</p>
<p>External temperature could be easily included in MPC model or RL observation as a disturbance.
With this, they could learn to adapt to its variations.</p>
<p>Only the PI controller is blind to the external temperature, however we could draw the bode diagram of <span class="math notranslate nohighlight">\(T_{ext}\)</span> -&gt; <span class="math notranslate nohighlight">\(T_{outlet}\)</span> to conclude on controller stability, offering a clear definition of the stability domain.</p>
<p><strong>Sensor failure</strong></p>
<p>Sensor failure has to be treated with a dedicated algorithm.
However, since MPC and RL rely on two measurements rather than one, they allow to measure the deviation between their inherent models and the real outputs, which offers a new quantity to monitor to detect sensor failures.</p>
</section>
<section id="complexity-flexibility-and-running-frequency">
<h3>Complexity, Flexibility and running frequency<a class="headerlink" href="#complexity-flexibility-and-running-frequency" title="Link to this heading">#</a></h3>
<p><strong>Complexity/Flexibility</strong></p>
<ul class="simple">
<li><p><strong>PI controller</strong> is very easy to implement and the effect of the tuning of its coefficients is easy to grasp. It could adapt easily to different situations and requirements with dedicated tuning.</p></li>
<li><p><strong>MPC controller</strong> is harder to implement, even when the model is available, bad tuning can results in non-feasible solutions, and despite long computations it might sometime reach suboptimal solutions. However, it is more flexible to changes in the reference tracking and can be easily adapted to new situations by adding a dedicated cost.</p></li>
<li><p><strong>RL controller</strong> takes time to train but is very fast at inference. The non continuity of the generated actions makes it non directly usable on real systems. Such algorithms need to be used with safeguards. Nonetheless, if a good simulation of the system is available, without having access to a direct model, RL might be the only algorithm to be able to reach a near-optimal solution. Reward cooking might be a long process, and balancing goals a difficult task.</p></li>
</ul>
<p><strong>Running frequency</strong></p>
<ol class="arabic simple">
<li><p>PI controller can run at a very high frequency because of its low computational cost, 1 Hz frequency was chosen because the system is naturally slow.</p></li>
<li><p>MPC requires a lot of computation, which might take more than a second to complete. Moreover, its horizon time is a function of its discretization step. For both reasons, it was run at 0.1 Hz, i.e. every 10s.</p></li>
<li><p>RL provides very fast inference, which is compatible with a 1 Hz frequency, however for training time reduction, this controller was also trained at 0.1 Hz.</p></li>
</ol>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>Following table summarizes some of our discussion:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Criteria</p></th>
<th class="head"><p>PI (Proportional-Integral)</p></th>
<th class="head"><p>MPC (Model Predictive Control)</p></th>
<th class="head"><p>RL (Reinforcement Learning)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Performance on Step</strong></p></td>
<td><p>✅ Excellent with good tuning</p></td>
<td><p>✅ Very good, no unnecessary input variations</p></td>
<td><p>❌ Shaky, struggles to maintain constant value</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Performance on Ramp</strong></p></td>
<td><p>❌ Needs specific tuning, delay not compensated</p></td>
<td><p>✅ Very good, compensates delay, no tuning needed</p></td>
<td><p>❌ Needs dedicated training</p></td>
</tr>
<tr class="row-even"><td><p><strong>Security (safety, constraints)</strong></p></td>
<td><p>⚠️ Done via gain scheduler</p></td>
<td><p>✅ Inherent</p></td>
<td><p>❌ Must be trained/tested on defined cases</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Complexity/Flexibility</strong></p></td>
<td><p>✅ Low, simple to implement &amp; test</p></td>
<td><p>❌ High, requires model &amp; solver</p></td>
<td><p>⚠️ Can be easy if sim available, but new tasks = retraining</p></td>
</tr>
<tr class="row-even"><td><p><strong>Running frequency</strong></p></td>
<td><p>✅ 1Hz, instant computation</p></td>
<td><p>❌ 0.1Hz, optimization takes ~1s</p></td>
<td><p>✅ 1Hz or 0.1Hz, fast inference</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Which one would you have picked on a real system?</strong></p>
</section>
<section id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Link to this heading">#</a></h2>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x\)</span>: Position along the pipe in <strong>meters (m)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(t\)</span>: Time in <strong>seconds (s)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(T(x, t)\)</span>: Temperature of water at position <span class="math notranslate nohighlight">\(x\)</span> and time <span class="math notranslate nohighlight">\(t\)</span> in <strong>kelvin (K)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(u\)</span>: Fluid velocity in <strong>meters per second (m/s)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho\)</span>: Density of water in <strong>kilograms per cubic meter (kg/m³)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(c_p\)</span>: Specific heat capacity of water in <strong>joules per kilogram-kelvin (J/(kg·K))</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(S\)</span>: Cross-sectional area of the pipe in <strong>square meters (m²)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_{\text{pipe}}\)</span>: Perimeter of the pipe in <strong>meters (m)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(h\)</span>: Convective heat transfer coefficient in <strong>watts per square meter-kelvin (W/(m²·K))</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(P\)</span>: Heater power input in <strong>watts (W)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(K = e^{-\frac{\alpha \tau}{2}}\)</span>: A factor representing the effect of time delay and thermal losses (dimensionless).</p></li>
<li><p><span class="math notranslate nohighlight">\(\tau\)</span>: Delay time in <strong>seconds (s)</strong>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span>: Heat loss coefficient in <strong>per second (1/s)</strong>.</p></li>
</ul>
</section>
<section id="simulation-details-impact-of-coefficients">
<h3>Simulation details : Impact of coefficients:<a class="headerlink" href="#simulation-details-impact-of-coefficients" title="Link to this heading">#</a></h3>
<p>Following plots the impact of heat loss coefficient and external temperature on the curves.</p>
<p><img alt="heat loop" src="../_images/param_comparison.png" /></p>
</section>
<section id="mpc-details-model-accuracy">
<h3>MPC details : Model accuracy<a class="headerlink" href="#mpc-details-model-accuracy" title="Link to this heading">#</a></h3>
<p>MPC uses a simplified version of the model with 20 pipe segments and a 10s integration steps, this creates discrepancies
in its prediction, the magnitude of the impact is show below on a 30kW input :</p>
<p><img alt="heat loop" src="../_images/MPC_vs_full_model.png" /></p>
</section>
<section id="note-on-code-and-llm-usage">
<h3>Note on code and LLM usage:<a class="headerlink" href="#note-on-code-and-llm-usage" title="Link to this heading">#</a></h3>
<p>This tutorial aims to present and discuss different technique usage.
Some slackness has sometimes been taken to simplify some aspects, without notification.
The initial project has been made in Matlab, code has been converted to Python partly using LLMs (OpenAI and Mistral)</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./heat_pipe_control"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Project tutorials</p>
      </div>
    </a>
    <a class="right-next"
       href="../drone_delayed_control/case_study.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Precision-landing of a Parrot drone</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-description">1. System Description</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-findings-why-is-it-tricky">First findings, why is it tricky?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-model">Naive model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#system-modeling">2. System Modeling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#physical-model-equations">Physical model equations:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-simulation">System Simulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control">3. Control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-objectives">Control Objectives</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traditionnal-siso-control-technique-with-tinkering">1) Traditionnal SISO control technique, with tinkering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-control-via-mpc-simo-control-fashion">2) Optimal control via MPC, SIMO control fashion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reinforcement-learning">3) Reinforcement Learning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-and-conclusion">Comparison and conclusion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performances-constant-setpoint-tracking">Performances : Constant setpoint tracking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performances-ramp-setpoint-tracking">Performances : Ramp setpoint tracking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security">Security</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complexity-flexibility-and-running-frequency">Complexity, Flexibility and running frequency</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">Appendix</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-details-impact-of-coefficients">Simulation details : Impact of coefficients:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mpc-details-model-accuracy">MPC details : Model accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-on-code-and-llm-usage">Note on code and LLM usage:</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Etienne Chassaing
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>